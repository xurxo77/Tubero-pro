<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<link rel="icon" type="image/png" href="favicon.png">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XURXO - Tubero Pro Elite v19.1</title>
<!-- Librerías de exportación -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root {
--bg-body: #0f172a;
--primary: #1e293b;
--accent: #f59e0b;
--blue-pro: #0284c7;
--text-main: #334155;
--text-light: #94a3b8;
--workshop-green: #059669;
--pdf-red: #ef4444;
--error-red: #b91c1c;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
body {
font-family: 'Segoe UI', Roboto, sans-serif;
background-color: var(--bg-body);
color: var(--text-main);
padding: 10px;
display: flex;
justify-content: center;
overflow-x: hidden;
}
#splash-screen {
position: fixed; top: 0; left: 0; width: 100%; height: 100%;
background: radial-gradient(circle, #1e293b 0%, #0f172a 100%);
display: flex; flex-direction: column; align-items: center; justify-content: center;
z-index: 10000; transition: opacity 0.8s ease, visibility 0.8s;
color: white; text-align: center;
}
.splash-logo { font-size: 3rem; font-weight: 900; letter-spacing: 5px; color: var(--accent); text-shadow: 0 0 20px rgba(245, 158, 11, 0.4); margin-bottom: 10px; animation: fadeInDown 1s ease forwards; opacity: 0; }
.splash-divider { width: 0; height: 4px; background: var(--accent); margin-bottom: 20px; animation: growLine 1.2s ease 0.5s forwards; }
.splash-name { font-size: 1.2rem; font-weight: 300; letter-spacing: 3px; text-transform: uppercase; animation: fadeInUp 1s ease 1s forwards; opacity: 0; }
.splash-version { margin-top: 30px; font-family: monospace; color: var(--text-light); font-size: 0.8rem; animation: fadeIn 1s ease 1.5s forwards; opacity: 0; }
@keyframes fadeInDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes growLine { from { width: 0; } to { width: 150px; } }
.app-container { width: 100%; max-width: 500px; background: #f1f5f9; min-height: 98vh; border-radius: 20px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 20px 40px rgba(0,0,0,0.5); position: relative; }
header { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: white; padding: 25px 15px; text-align: center; border-bottom: 4px solid var(--accent); }
.owner-badge { background: var(--accent); color: #000; padding: 4px 15px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; display: inline-block; margin-top: 8px; text-transform: uppercase; }
#ui-message { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); background: var(--error-red); color: white; padding: 12px 20px; border-radius: 10px; font-size: 0.85rem; font-weight: bold; z-index: 10000; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.3); display: none; width: 90%; text-align: center; }
.nav-tabs { display: grid; grid-template-columns: repeat(3, 1fr); background: #1e293b; gap: 1px; }
.tab-btn { background: #1e293b; border: none; color: #94a3b8; padding: 12px 5px; cursor: pointer; display: flex; flex-direction: column; align-items: center; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; transition: 0.3s; }
.tab-btn svg { width: 18px; height: 18px; fill: currentColor; margin-bottom: 4px; }
.tab-btn.active { color: var(--accent); background: #334155; border-bottom: 3px solid var(--accent); }
.main-content { flex: 1; padding: 15px; overflow-y: auto; }
.section { display: none; }
.section.active { display: block; }
h2 { font-size: 1.1rem; color: var(--primary); margin-bottom: 12px; border-left: 4px solid var(--accent); padding-left: 10px; }
.card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
.input-group { margin-bottom: 15px; }
.input-group label { display: block; font-size: 0.7rem; font-weight: 700; color: #64748b; margin-bottom: 4px; text-transform: uppercase; }
.input-group input, .input-group select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; font-weight: 600; }
.btn-main { background: var(--blue-pro); color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: 700; text-transform: uppercase; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
.canvas-wrap { background: #0f172a; border-radius: 15px; margin-top: 15px; padding: 15px; overflow: hidden; border: 1px solid #334155; }
.canvas-label { font-size: 0.65rem; color: var(--accent); font-weight: 800; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 1px; }
.radio-group { display: flex; gap: 8px; }
.radio-btn { flex: 1; padding: 12px; background: #e2e8f0; border-radius: 10px; text-align: center; font-size: 0.8rem; font-weight: 700; cursor: pointer; }
.radio-btn.active { background: var(--blue-pro); color: white; }
#loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: white; text-align: center; padding: 20px; }
.spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.data-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
.data-table th { background: #1e293b; color: white; padding: 10px; text-align: center; }
.data-table td { border-bottom: 1px solid #e2e8f0; padding: 10px; text-align: center; font-weight: 600; }
.sling-row { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; background: white; padding: 12px; border-radius: 12px; }
</style>
</head>
<body>
<div id="splash-screen">
<div class="splash-logo">TUBERO PRO</div>
<div class="splash-divider"></div>
<div class="splash-name">OFICIAL: XURXO</div>
<div class="splash-version">BUILD 2024 - v19.1 INDUSTRIAL</div>
</div>
<div id="ui-message">Aviso</div>
<div id="loading-overlay">
<div class="spinner"></div>
<div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 10px;">PROCESANDO DOCUMENTOS</div>
<div id="loading-msg" style="font-size: 0.9rem; color: var(--accent); max-width: 300px;">XURXO, estamos preparando la información técnica...</div>
</div>
<div class="app-container" id="capture-area">
<header>
<h1>TUBERO PRO</h1>
<div class="owner-badge">OFICIAL: XURXO</div>
<div class="subtitle">EDICIÓN ELITE v19.1</div>
</header>

<nav class="nav-tabs" id="nav-ignore">
<button class="tab-btn active" onclick="setTab('tab-bocapez', this)">Boca Pez</button>
<button class="tab-btn" onclick="setTab('tab-bayoneta', this)">Bayoneta</button>
<button class="tab-btn" onclick="setTab('tab-bridas', this)">Bridas</button>
<button class="tab-btn" onclick="setTab('tab-pesos', this)">Pesos</button>
<button class="tab-btn" onclick="setTab('tab-codos', this)">Codos</button>
<button class="tab-btn" onclick="setTab('tab-cargas', this)">Izaje</button>
</nav>

<div class="main-content">
<!-- Módulo Boca de Pez mejorado -->
<div id="tab-bocapez" class="section active">
<h2>Injerto Boca de Pez (Ángulo Variable)</h2>
<div class="card">
<div class="input-group">
<label>Unidades</label>
<div class="radio-group">
<div class="radio-btn active" id="unIn" onclick="setUn('in')">Pulgadas</div>
<div class="radio-btn" id="unMm" onclick="setUn('mm')">mm</div>
</div>
</div>
<div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
<div class="input-group"><label>Cabezal (OD)</label><input type="number" id="bpC" placeholder="6"></div>
<div class="input-group"><label>Ramal (OD)</label><input type="number" id="bpR" placeholder="4"></div>
</div>
<div style="display:grid; grid-template-columns:1fr 1fr; gap:10px">
<div class="input-group"><label>Ángulo Inclinación (°)</label><input type="number" id="bpAng" value="90"></div>
<div class="input-group">
<label>Divisiones</label>
<div class="radio-group">
<div class="radio-btn active" id="div8" onclick="setDiv(8)">8</div>
<div class="radio-btn" id="div16" onclick="setDiv(16)">16</div>
</div>
</div>
</div>
<label style="display:flex; align-items:center; gap:10px; font-size:0.85rem; background:#fff7ed; padding:12px; border-radius:10px; border:1px solid #ffedd5; color:#9a3412; cursor:pointer;">
<input type="checkbox" id="bpMarg" style="width:18px; height:18px;"> +30mm Faja de Papel
</label>
<button class="btn-main" style="margin-top:15px;" onclick="calcBP()">Generar Informe y Trazado</button>
</div>

<div id="resBP" style="display:none">
<div class="canvas-wrap">
<div class="canvas-label">Vista Técnica de Montaje</div>
<svg id="jointSvg" viewBox="0 0 400 300" style="background: #0f172a;"></svg>
</div>

<div style="background:#eff6ff; padding:15px; border-radius:15px; margin-bottom:15px; border:2px solid #3b82f6; display:flex; justify-content: space-around; text-align: center; margin-top: 15px;">
<div><div style="font-size:0.65rem; color:#1e40af; font-weight:800;">PERÍMETRO</div><div id="bpPer" style="font-size:1.1rem; font-weight:900; color:#1e3a8a;">0</div></div>
<div style="width:1px; background:#bfdbfe;"></div>
<div><div style="font-size:0.65rem; color:#1e40af; font-weight:800;">PASO</div><div id="bpPas" style="font-size:1.1rem; font-weight:900; color:#1e3a8a;">0</div></div>
</div>

<div class="card">
<table class="data-table" id="tableBP">
<thead><tr><th>PTO</th><th>GRAD</th><th>ORD (mm)</th></tr></thead>
<tbody></tbody>
</table>
</div>

<div class="canvas-wrap">
<div class="canvas-label">Plantilla para Corte</div>
<svg id="bpSvg" viewBox="0 0 400 160"></svg>
</div>
</div>
<!-- El resto de módulos queda igual -->
</div>
</div>

<script>
window.addEventListener('load', () => { setTimeout(()=>{document.getElementById('splash-screen').style.opacity='0'; setTimeout(()=>{document.getElementById('splash-screen').style.display='none';},800);},3000); });

let unitBP='in', divBP=8, exportFormat='a4';
let lastBP={pts:[], per:0, r:0, c:0, unit:'in', paso:0, angle:90};

function showMsg(t){ const box=document.getElementById('ui-message'); box.innerText=t; box.style.display='block'; setTimeout(()=>{box.style.display='none';},3000);}
function setTab(id,btn){document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.getElementById(id).classList.add('active');btn.classList.add('active');}
function setUn(u){unitBP=u;document.getElementById('unIn').classList.toggle('active',u==='in');document.getElementById('unMm').classList.toggle('active',u==='mm');}
function setDiv(d){divBP=d;document.getElementById('div8').classList.toggle('active',d===8);document.getElementById('div16').classList.toggle('active',d===16);}
function calcBP(){
let cIn=parseFloat(document.getElementById('bpC').value);
let rIn=parseFloat(document.getElementById('bpR').value);
let ang=parseFloat(document.getElementById('bpAng').value);
let marg=document.getElementById('bpMarg').checked?30:0;
if(!cIn||!rIn||!ang){showMsg("Faltan datos");return;}
let R_cab=(unitBP==='in'?cIn*25.4:cIn)/2;
let r_ram=(unitBP==='in'?rIn*25.4:rIn)/2;
if(r_ram>R_cab){showMsg("Ramal > Cabezal");return;}
let per=r_ram*2*Math.PI;
let paso=per/divBP;
lastBP={pts:[], per, r:rIn, c:cIn, unit:unitBP, paso, angle:ang};
let tbody=document.querySelector("#tableBP tbody"); tbody.innerHTML="";
for(let i=0;i<=divBP;i++){
let phi=i*2*Math.PI/divBP;
let y=(Math.sqrt(R_cab*R_cab - r_ram*r_ram*Math.sin(phi)*Math.sin(phi))/Math.sin(ang*Math.PI/180))-(r_ram*Math.cos(phi)/Math.tan(ang*Math.PI/180
